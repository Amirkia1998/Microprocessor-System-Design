
PIC0 EQU 60H
PIC1 EQU 62H
USARTD EQU 7CH
USARTC EQU 7EH

CODE SEGMENT PARA 'CODE'
        ASSUME CS:CODE, DS:DATA, SS:STK

READ_INT PROC FAR

   PUSH AX
   PUSH BP
   MOV BP, SP

   IN AL, USARTD
   SHR AL, 1
   INC AL
   MOV MY_DATA[SI], AL
   INC SI
   CMP SI, 5
   JNE LR1
   MOV AL, 00000001B ;MASK
   OUT PIC1, AL

   XOR SI, SI

   LR1: 
	 POP BP
	 POP AX
	 MOV AL, 01100000B ;EOI
	 OUT PIC0, AL
   
   IRET
READ_INT ENDP

WRITE_INT PROC FAR
  PUSH AX
  PUSH BP
  MOV BP, SP
  
  MOV AL, MY_DATA[SI]
  OUT USARTD, AL
  INC SI
  CMP SI, 5
  JNE LW2
  MOV AL, 00000010B ;MASK
  OUT PIC1, AL

  XOR SI, SI

   LW2: 
	 POP BP
	 POP AX
	 MOV AL, 01100001B ;EOI
	 OUT PIC0, AL
	 
  IRET
WRITE_INT ENDP

START PROC FAR
  MOV AX, DATA
  MOV DS, AX

  XOR AX, AX
  MOV ES, AX
  MOV AL, 78H
  MOV AH, 4
  MUL AH
  MOV BX, AX

  LEA AX, READ_INT
  MOV WORD PTR ES:[BX], AX
  LEA AX, WRITE_INT
  MOV WORD PTR ES:[BX+4], AX

  MOV AX, CS
  MOV WORD PTR ES:[BX+2], AX
  MOV WORD PTR ES:[BX+6], AX

  MOV AL, 00010011B ;ICW1
  OUT PIC0, AL

  MOV AL, 78H   ;ICW2
  OUT PIC1, AL

  MOV AL, 00000011B ;ICW4
  OUT PIC1, AL

  MOV AL, 00000011B ;MASK
  OUT PIC1, AL
  
  MOV AL, 01001101B ;Set 8251 Mod
  OUT USARTC, AL

  MOV AL, 40H   ;Internal Reset
  OUT USARTC, AL

  MOV AL, 01001101B ;Set 8251 Mod
  OUT USARTC, AL

  MOV AL, 00010101B ;Enable Rx/Tx
  OUT USARTC, AL
  
  XOR SI, SI
  STI
  MOV AL, 00000010B ;MASK
  OUT PIC1, AL

ENDLESS:


  JMP ENDLESS
  RET
START ENDP

CODE ENDS

STK SEGMENT PARA STACK 'STACK'

  DW 50 DUP(?)
  
STK ENDS

DATA SEGMENT PARA 'DATA'

MY_DATA DB 10 DUP(?)

DATA ENDS

END  START